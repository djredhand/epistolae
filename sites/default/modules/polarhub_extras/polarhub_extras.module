<?php

/*
 * http://willvincent.com/blog/adding-one-or-more-fields-drupal-7-contact-form
 */

/**
* Implements hook_form_contact_site_form_alter().
* This function will add a phone number field to the site-wide contact form,
* by implementing hook_form_FORM_ID_alter().
*/
function polarhub_extras_form_contact_site_form_alter(&$form, &$form_state, $form_id) {

  // Add a phone number field to the contact form.
  $form['institution'] = array(
			 '#type' => 'textfield',
			 '#maxlength' => 20,
			 '#title' => t('Your Institutional Affiliation'),
			 '#required' => True,
			 );

  $form['department'] = array(
			 '#type' => 'textfield',
			 '#maxlength' => 20,
			 '#title' => t('Your Department'),
			 );

  $form['phone'] = array(
			 '#type' => 'textfield',
			 '#maxlength' => 20,
			 '#title' => t('Your Phone Number'),
			 );
  
  // Define the order of the top level elements on the form (include those from contact_site_form().
  $order = array('name', 'institution', 'department', 'mail', 'phone', 'subject', 'cid', 'message', 'copy', 'actions');
  
  // Order the elements by changing their #weight property.

  foreach($order as $key => $field) {
    $form[$field]['#weight'] = $key;
  }

  // captcha has a weight of 0. position it above submit button
  $form['captcha']['#weight'] = 8;
}

/**
 * Implements hook_mail_alter().
 */
function polarhub_extras_mail_alter(&$message) {
  // We only want to alter the email if it's being
  // generated by the site-wide contact form page.
  if ($message['id'] == 'contact_page_mail') {
    if (isset($message['params']['institution']) && $message['params']['institution'] != '') {
      $message['body'][] = t('Institution') .': '. $message['params']['institution'];
    }
    if (isset($message['params']['department']) && $message['params']['department'] != '') {
      $message['body'][] = t('Department') .': '. $message['params']['department'];
    }
    if (isset($message['params']['phone']) && $message['params']['phone'] != '') {
      $message['body'][] = t('Phone') .': '. $message['params']['phone'];
    }
  }
}

?>